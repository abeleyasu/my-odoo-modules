<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- RingCentral Call Tree View -->
    <record id="ringcentral_call_view_tree" model="ir.ui.view">
        <field name="name">ringcentral.call.tree</field>
        <field name="model">ringcentral.call</field>
        <field name="arch" type="xml">
            <list string="Calls" default_order="start_time desc" decoration-success="state == 'ended' and call_result == 'answered'" decoration-warning="state == 'missed'" decoration-danger="state == 'failed'">
                <field name="start_time"/>
                <field name="direction" widget="badge" decoration-info="direction == 'inbound'" decoration-success="direction == 'outbound'"/>
                <field name="phone_number"/>
                <field name="partner_id"/>
                <field name="state" widget="badge"/>
                <field name="call_result"/>
                <field name="duration_display" string="Duration"/>
                <field name="user_id" widget="many2one_avatar_user"/>
                <field name="call_outcome" optional="show"/>
                <field name="is_recording" optional="hide"/>
            </list>
        </field>
    </record>
    
    <!-- RingCentral Call Form View -->
    <record id="ringcentral_call_view_form" model="ir.ui.view">
        <field name="name">ringcentral.call.form</field>
        <field name="model">ringcentral.call</field>
        <field name="arch" type="xml">
            <form string="Call">
                <header>
                    <field name="state" widget="statusbar" statusbar_visible="pending,ringing,answered,ended"/>
                    <button name="action_hangup" type="object" string="Hang Up" class="btn-danger" invisible="state not in ('answered', 'on_hold')"/>
                    <button name="action_toggle_hold" type="object" string="Hold" invisible="state != 'answered'"/>
                    <button name="action_toggle_hold" type="object" string="Unhold" invisible="state != 'on_hold'"/>
                    <button name="action_toggle_mute" type="object" string="Mute" invisible="state not in ('answered', 'on_hold') or is_muted"/>
                    <button name="action_toggle_mute" type="object" string="Unmute" invisible="state not in ('answered', 'on_hold') or not is_muted"/>
                    <button name="action_start_recording" type="object" string="Start Recording" invisible="state not in ('answered', 'on_hold') or is_recording"/>
                    <button name="action_stop_recording" type="object" string="Stop Recording" class="btn-warning" invisible="state not in ('answered', 'on_hold') or not is_recording"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_partner_calls" type="object" class="oe_stat_button" icon="fa-history" invisible="not partner_id">
                            <div class="o_stat_info">
                                <span class="o_stat_text">Call History</span>
                            </div>
                        </button>
                        <button name="action_view_recordings" type="object" class="oe_stat_button" icon="fa-microphone" invisible="not recording_id">
                            <div class="o_stat_info">
                                <span class="o_stat_text">Recordings</span>
                            </div>
                        </button>
                        <button name="action_open_related_record" type="object" class="oe_stat_button" icon="fa-external-link" invisible="not res_model or not res_id">
                            <div class="o_stat_info">
                                <span class="o_stat_text">Related Record</span>
                            </div>
                        </button>
                    </div>
                    <widget name="web_ribbon" title="Recording" bg_color="text-bg-danger" invisible="not is_recording"/>
                    <group>
                        <group>
                            <field name="phone_number"/>
                            <field name="direction"/>
                            <field name="partner_id"/>
                            <field name="user_id"/>
                        </group>
                        <group>
                            <field name="start_time"/>
                            <field name="answer_time"/>
                            <field name="end_time"/>
                            <field name="duration_display" string="Duration"/>
                        </group>
                    </group>
                    <group>
                        <group string="Result">
                            <field name="call_result"/>
                            <field name="call_outcome"/>
                        </group>
                        <group string="Recording &amp; Transcription">
                            <field name="is_recording" widget="boolean_toggle"/>
                            <field name="recording_id" invisible="not recording_id"/>
                            <field name="recording_url" widget="url" invisible="not recording_url"/>
                            <field name="recording_attachment_id" invisible="not recording_attachment_id"/>
                            <div colspan="2" invisible="recording_id or recording_url" class="text-muted">
                                <em>No recording available. Recordings are fetched automatically after calls with recording enabled.</em>
                            </div>
                        </group>
                    </group>
                    <group string="RingCentral Info" groups="ringcentral_base.group_ringcentral_admin">
                        <field name="ringcentral_call_id"/>
                        <field name="ringcentral_session_id"/>
                        <field name="ringcentral_party_id"/>
                        <field name="ringout_id"/>
                    </group>
                    <group string="Related Record" invisible="not res_model">
                        <field name="res_model"/>
                        <field name="res_id"/>
                    </group>
                    <group string="Notes">
                        <field name="notes" nolabel="1" colspan="2"/>
                    </group>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>
    
    <!-- RingCentral Call Search View -->
    <record id="ringcentral_call_view_search" model="ir.ui.view">
        <field name="name">ringcentral.call.search</field>
        <field name="model">ringcentral.call</field>
        <field name="arch" type="xml">
            <search string="Calls">
                <field name="phone_number"/>
                <field name="partner_id"/>
                <field name="user_id"/>
                <filter name="filter_inbound" string="Inbound" domain="[('direction', '=', 'inbound')]"/>
                <filter name="filter_outbound" string="Outbound" domain="[('direction', '=', 'outbound')]"/>
                <separator/>
                <filter name="filter_answered" string="Answered" domain="[('call_result', '=', 'answered')]"/>
                <filter name="filter_missed" string="Missed" domain="[('state', '=', 'missed')]"/>
                <filter name="filter_voicemail" string="Voicemail" domain="[('call_result', '=', 'voicemail')]"/>
                <separator/>
                <filter name="filter_today" string="Today" domain="[('start_time', '>=', context_today().strftime('%Y-%m-%d'))]"/>
                <filter name="filter_week" string="This Week" domain="[('start_time', '>=', (context_today() - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"/>
                <separator/>
                <filter name="filter_has_recording" string="Has Recording" domain="[('recording_id', '!=', False)]"/>
                <separator/>
                <filter name="group_direction" string="Direction" context="{'group_by': 'direction'}"/>
                <filter name="group_partner" string="Contact" context="{'group_by': 'partner_id'}"/>
                <filter name="group_user" string="User" context="{'group_by': 'user_id'}"/>
                <filter name="group_day" string="Day" context="{'group_by': 'start_time:day'}"/>
                <filter name="group_outcome" string="Outcome" context="{'group_by': 'call_outcome'}"/>
            </search>
        </field>
    </record>
    
    <!-- RingCentral Call Kanban View -->
    <record id="ringcentral_call_view_kanban" model="ir.ui.view">
        <field name="name">ringcentral.call.kanban</field>
        <field name="model">ringcentral.call</field>
        <field name="arch" type="xml">
            <kanban default_group_by="state" class="o_kanban_mobile">
                <field name="phone_number"/>
                <field name="partner_id"/>
                <field name="direction"/>
                <field name="state"/>
                <field name="duration_display"/>
                <field name="start_time"/>
                <templates>
                    <t t-name="kanban-card">
                        <div class="oe_kanban_global_click">
                            <div class="o_kanban_record_top">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <field name="phone_number"/>
                                    </strong>
                                </div>
                                <span t-if="record.direction.raw_value == 'inbound'" class="badge text-bg-info">↓ Inbound</span>
                                <span t-else="" class="badge text-bg-success">↑ Outbound</span>
                            </div>
                            <div class="o_kanban_record_body">
                                <field name="partner_id"/>
                            </div>
                            <div class="o_kanban_record_bottom">
                                <div class="oe_kanban_bottom_left">
                                    <field name="start_time" widget="datetime"/>
                                </div>
                                <div class="oe_kanban_bottom_right">
                                    <field name="duration_display"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    
    <!-- RingCentral Call Graph View -->
    <record id="ringcentral_call_view_graph" model="ir.ui.view">
        <field name="name">ringcentral.call.graph</field>
        <field name="model">ringcentral.call</field>
        <field name="arch" type="xml">
            <graph string="Calls" type="bar">
                <field name="start_time" type="row" interval="day"/>
                <field name="direction" type="col"/>
                <field name="id" type="measure" string="Count"/>
            </graph>
        </field>
    </record>
    
    <!-- RingCentral Call Pivot View -->
    <record id="ringcentral_call_view_pivot" model="ir.ui.view">
        <field name="name">ringcentral.call.pivot</field>
        <field name="model">ringcentral.call</field>
        <field name="arch" type="xml">
            <pivot string="Call Statistics">
                <field name="user_id" type="row"/>
                <field name="direction" type="col"/>
                <field name="duration" type="measure" string="Total Duration"/>
            </pivot>
        </field>
    </record>
    
    <!-- RingCentral Call Calendar View -->
    <record id="ringcentral_call_view_calendar" model="ir.ui.view">
        <field name="name">ringcentral.call.calendar</field>
        <field name="model">ringcentral.call</field>
        <field name="arch" type="xml">
            <calendar string="Calls" date_start="start_time" date_stop="end_time" color="direction" quick_create="0">
                <field name="phone_number"/>
                <field name="partner_id"/>
                <field name="duration_display"/>
            </calendar>
        </field>
    </record>
    
    <!-- Call Action -->
    <record id="action_ringcentral_call" model="ir.actions.act_window">
        <field name="name">Calls</field>
        <field name="res_model">ringcentral.call</field>
        <field name="view_mode">list,kanban,form,graph,pivot,calendar</field>
        <field name="search_view_id" ref="ringcentral_call_view_search"/>
        <field name="context">{'search_default_filter_today': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No calls yet
            </p>
            <p>
                Click on a phone field to make your first call!
            </p>
        </field>
    </record>
    
</odoo>
