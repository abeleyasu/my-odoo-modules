<!DOCTYPE html>
<html>
<head>
    <title>RingCentral Widget Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        .status { margin: 10px 0; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        pre {
            background: #eee;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background: #0073ea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="info">
        <h1>RingCentral Widget Test Page</h1>
        <p>This page tests the RingCentral Embeddable widget with your credentials.</p>
        
        <h3>Configuration:</h3>
        <pre>
Client ID: 2b12UVsvXpCd04ZCrbd7q8
Server: https://platform.ringcentral.com (Production)
Redirect URI: https://apps.ringcentral.com/integration/ringcentral-embeddable/latest/redirect.html
        </pre>
        
        <h3>Status:</h3>
        <div id="status" class="status">Loading widget...</div>
        
        <h3>Actions:</h3>
        <button onclick="testCall()">Test Call (555-1234)</button>
        <button onclick="showWidget()">Show Widget</button>
        <button onclick="hideWidget()">Hide Widget</button>
        
        <h3>Instructions:</h3>
        <ol>
            <li>Wait for the widget to load (bottom-right corner)</li>
            <li>Click the widget icon to expand it</li>
            <li>Click "Sign In" and log in with your RingCentral credentials</li>
            <li>If login popup doesn't appear, check browser popup blocker</li>
        </ol>
        
        <h3>Events Log:</h3>
        <div id="log" style="background:#fff;padding:10px;border:1px solid #ddd;height:200px;overflow-y:auto;font-family:monospace;font-size:12px;"></div>
    </div>

    <script>
        function log(message, type) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            logDiv.innerHTML = `<div style="color:${color}">[${time}] ${message}</div>` + logDiv.innerHTML;
        }

        function updateStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
        }

        // Listen for widget messages
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type) {
                log(`Widget event: ${event.data.type}`, 'info');
                
                if (event.data.type === 'rc-login-status-changed') {
                    if (event.data.loggedIn) {
                        updateStatus('✅ Logged in to RingCentral!', 'success');
                        log('Login successful!', 'success');
                    } else {
                        updateStatus('⚠️ Not logged in - click Sign In on the widget', 'warning');
                    }
                }
                
                if (event.data.type === 'rc-webphone-registered') {
                    log('WebPhone registered - ready to make calls!', 'success');
                }
                
                if (event.data.type === 'rc-call-start-notify') {
                    log('Call started: ' + JSON.stringify(event.data), 'info');
                }
                
                if (event.data.type === 'rc-call-end-notify') {
                    log('Call ended: ' + JSON.stringify(event.data), 'info');
                }
            }
        });

        function testCall() {
            log('Initiating test call...', 'info');
            window.postMessage({
                type: 'rc-adapter-new-call',
                phoneNumber: '5551234',
                toCall: true
            }, '*');
        }

        function showWidget() {
            window.postMessage({
                type: 'rc-adapter-minimize',
                minimize: false
            }, '*');
        }

        function hideWidget() {
            window.postMessage({
                type: 'rc-adapter-minimize',
                minimize: true
            }, '*');
        }

        // Load the widget - using PKCE flow (default for v1.4.0+)
        // No clientSecret needed for PKCE!
        log('Loading RingCentral Embeddable widget (PKCE flow)...', 'info');
        
        var script = document.createElement('script');
        script.src = 'https://apps.ringcentral.com/integration/ringcentral-embeddable/latest/adapter.js?' +
            'clientId=2b12UVsvXpCd04ZCrbd7q8' +
            '&appServer=https://platform.ringcentral.com' +
            '&redirectUri=https://apps.ringcentral.com/integration/ringcentral-embeddable/latest/redirect.html';
        
        script.onload = function() {
            log('Widget script loaded successfully!', 'success');
            updateStatus('⏳ Widget loaded - look for phone icon in bottom-right corner', 'warning');
            
            // Check if RCAdapter is available after a short delay
            setTimeout(function() {
                if (window.RCAdapter) {
                    log('RCAdapter is available!', 'success');
                } else {
                    log('RCAdapter not found - widget may still be initializing', 'warning');
                }
            }, 2000);
        };
        
        script.onerror = function(e) {
            log('Failed to load widget script!', 'error');
            updateStatus('❌ Failed to load widget', 'error');
        };
        
        document.body.appendChild(script);
    </script>
</body>
</html>
